# Curve25519

Curve25519 是一条由著名密码学家 **Daniel J. Bernstein**（djb）于 2005 年设计的**椭圆曲线**，因其高效性、安全性以及对实现攻击（如时序攻击、缓存攻击）的天然抵抗力，已成为现代密码学中最广泛采用的椭圆曲线之一。


## 基本参数

- **素数域**（Prime field）：
  $$
  p = 2^{255} - 19
  $$
  这是一个接近 $2^{255}$ 的大素数，因此曲线得名 **Curve25519**。

- **曲线方程**（Montgomery 形式）：
  $$
  y^2 = x^3 + A x^2 + x \quad \text{over } \mathbb{F}_p
  $$
  其中系数 $A = 486662$。

  所以完整方程为：
  $$
  y^2 = x^3 + 486662x^2 + x \mod (2^{255} - 19)
  $$

- **基点**（Base point）：
  - Curve25519 用于 **Diffie-Hellman 密钥交换**（即 X25519），其标准基点的 **x 坐标为 9**。
  - 即：使用 $x = 9$ 作为公钥生成起点（对应的 y 坐标存在但不显式使用）。

- **阶**（Order of the group）：
  - 曲线上的有理点群（包含无穷远点）的阶为：
    $$
    \#E(\mathbb{F}_p) = 8 \cdot \ell
    $$
    其中 $\ell$ 是一个 **253 位的大素数**：
    $$
    \ell = 2^{252} + 27742317777372353535851937790883648493
    $$
  - 因此，该曲线有一个 **小的余因子**（cofactor）$h = 8$。


## 为何选择 Montgomery 形式？

Montgomery 曲线具有以下优势：

1. **仅需 x 坐标即可完成标量乘法**（scalar multiplication）：
   - 使用 **Montgomery ladder** 算法，可在恒定时间内完成计算，天然抗侧信道攻击。
2. **高效**：
   - 标量乘法速度极快，适合资源受限设备（如嵌入式系统、移动设备）。
3. **避免点压缩/解压开销**。

> 正因如此，Curve25519 被标准化为 **X25519**，专用于 ECDH 密钥交换（见 RFC 7748）。


## 与 Ed25519 的关系

虽然 Curve25519 使用 **Montgomery 形式**，但它与 **twisted Edwards 曲线**（用于 Ed25519）是**双有理等价**（birationally equivalent）的。

- Ed25519 使用的 twisted Edwards 曲线方程为：
  $$
  -x^2 + y^2 = 1 + d x^2 y^2, \quad \text{其中 } d = -\frac{121665}{121666} \mod p
  $$
- 存在一个明确的数学映射，可以在 Montgomery 点 $(x, y)$ 和 Edwards 点 $(u, v)$ 之间转换：
  $$
  u = \frac{1 + y}{1 - y}, \quad x = \frac{u}{v}
  $$
  （具体公式可参考 Bernstein 的原始论文）

这意味着：
- 同一底层曲线可用于 **密钥交换**（X25519）和 **数字签名**（Ed25519）。
- 但**私钥不能直接混用**，因为格式和“clamping”规则不同。


## 安全性特点

| 特性 | 说明 |
|------|------|
| **安全强度** | 约 128 位（对标 AES-128） |
| **抗 MOV 攻击、Smart 攻击等** | 是，因曲线设计避开弱结构 |
| **余因子处理** | 协议层需清除余因子影响（如 X25519 在计算共享密钥后会乘以 $\ell$ 或忽略低阶分量） |
| **随机数无关** | X25519 本身是确定性算法；Ed25519 签名也是确定性的（不依赖 RNG） |
| **标准化** | RFC 7748（X25519）、RFC 8032（Ed25519） |


## 实际应用

- **TLS 1.3**：默认支持 X25519 作为密钥交换算法。
- **Signal 协议**：使用 X25519 进行端到端加密的密钥协商。
- **WireGuard**：VPN 协议，完全基于 X25519 和 ChaCha20-Poly1305。
- **OpenSSH**：支持 `curve25519-sha256` 密钥交换。
- **区块链**：如 Monero、Zcash 等使用 Curve25519 变种进行隐私保护。
