# AES 算法

AES（Advanced Encryption Standard，高级加密标准）是一种对称加密算法，广泛用于保护电子数据的安全。它由美国国家标准与技术研究院（NIST）于2001年正式采纳，用以替代旧的DES（Data Encryption Standard）算法。

[FIPS-197标准](https://csrc.nist.gov/pubs/fips/197/final)

## 一、基本特性

- **对称加密**：加密和解密使用相同的密钥。
- **分组长度固定**：128 位（即 16 字节）。
- **密钥长度可变**：支持 128 位、192 位 和 256 位三种密钥长度，分别对应 AES-128、AES-192 和 AES-256。
- **安全性高**：目前没有已知的实用攻击能破解完整轮数的 AES（在正确使用前提下）。
- **效率高**：软硬件实现都高效，适合各种平台（包括嵌入式设备）。

## 二、加密流程（以 AES-128 为例）

AES 加密过程将明文划分为 128 位的块，并通过多轮变换进行加密。AES-128 执行 10 轮，AES-192 执行 12 轮，AES-256 执行 14 轮。

每轮包含以下四个操作（最后一轮略去 MixColumns）：

1. [**SubBytes（字节替换）**](./doc/sub_bytes.md)
   
   使用 S-Box（非线性替换表）对每个字节进行替换，提供混淆（confusion）。

2. **状态矩阵**

   AES 按列主序（column-major order）将明文填入状态矩阵：

   明文：P = p₀, p₁, p₂, ..., p₁₅
   
   填入后：
   
   第 0 列：s[0][0] = p₀, s[1][0] = p₁, s[2][0] = p₂, s[3][0] = p₃
   
   第 1 列：s[0][1] = p₄, s[1][1] = p₅, ..., 以此类推

3. [**ShiftRows（行移位）**](./doc/shift_rows.md)
   
   状态矩阵的每一行进行循环左移，不同行移动不同位数，提供扩散（diffusion）。

4. [**MixColumns（列混淆）**](./doc/mix_columns.md)

   对状态矩阵的每一列进行线性变换（在 GF(2⁸) 域上），进一步增强扩散性。

5. **AddRoundKey（轮密钥加）**
   
   将当前状态与轮密钥进行按位异或（XOR）。

> 初始轮只做 AddRoundKey；最后一轮省略 MixColumns。

## 三、[密钥扩展（Key Expansion）](./doc/key_expansion.md)

原始密钥通过密钥调度算法扩展为多个轮密钥（每轮一个）。扩展过程包括：
- 使用 Rcon（轮常量）
- 应用 SubBytes
- 循环移位和异或操作

确保每轮使用的密钥不同且与原始密钥相关。

## 四、工作模式（Block Cipher Modes of Operation）

由于 AES 是分组密码，需配合工作模式处理长于 128 位的数据。常见模式包括：

| 模式 | 特点 | 是否需要 IV | 是否并行 | 安全性 |
|------|------|-------------|--------|--------|
| ECB（电子密码本） | 相同明文 → 相同密文 | 否 | 是 | 不推荐（暴露数据模式） |
| CBC（密码分组链接） | 引入 IV，前一块密文影响下一块 | 是 | 否（加密）/是（解密） | 安全（但需防 padding oracle） |
| CTR（计数器） | 将分组密码转为流密码 | 是（nonce+counter） | 是 | 安全、高效 |
| GCM（Galois/Counter Mode） | 支持认证加密（AEAD） | 是 | 是 | 高安全性，常用于 TLS |
| CFB / OFB | 流模式变种 | 是 | 否（CFB）/是（OFB 解密） | 较少使用 |

## 五、应用场景

- HTTPS/TLS 中的数据加密（常与 RSA/ECDH 配合）
- 磁盘加密（如 BitLocker、FileVault）
- 无线网络安全（WPA2/WPA3）
- 数据库存储加密
- 移动应用本地数据保护

## 六、安全性说明

- **理论安全性**：AES 被认为是计算安全的。即使使用量子计算机，Grover 算法也只能将密钥搜索空间开平方（例如 AES-128 降到 2⁶⁴，仍不可行）。
- **实践建议**：
  - 使用 AES-256 可应对未来威胁（如量子计算）。
  - 避免使用 ECB 模式。
  - 使用带认证的模式（如 GCM）防止篡改。
  - 密钥必须安全生成和存储（使用 CSPRNG）。

