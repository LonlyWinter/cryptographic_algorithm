# DSA 算法

DSA（Digital Signature Algorithm，数字签名算法）是一种用于生成和验证数字签名的公钥加密算法，由美国国家标准与技术研究院（NIST）于1991年提出，并作为**数字签名标准**（DSS, Digital Signature Standard）的一部分发布（FIPS 186）。DSA 的设计目的是提供一种安全、高效的数字签名机制，但**不用于加密或密钥交换**。


### 一、DSA 的基本原理

DSA 基于**离散对数问题**（Discrete Logarithm Problem, DLP）的计算困难性，其安全性依赖于在有限域中求解离散对数的难度。

与 RSA 不同，DSA **只能用于签名和验证**，不能用于加密。


## 二、参数选择（系统参数）

DSA 的安全性依赖于一组公共参数 $(p, q, g)$，其中：

- $p$：一个大素数（通常为 1024~3072 位）
- $q$：一个素数，是 $p - 1$ 的素因子，通常为 160~256 位
- $g$：满足 $g = h^{(p-1)/q} \bmod p$，其中 $h$ 是任意整数且 $1 < h < p-1$，使得$g > 1$

这些参数可以是全局共享的（如 FIPS 186-4 推荐的标准参数），也可以由用户自定义。


## 三、密钥生成

1. **私钥** $x$：随机选择一个整数，满足 $1 < x < q$
2. **公钥** $y$：计算 $ y = g^x \bmod p $

> 公钥为 $(p, q, g, y)$，私钥为 $x$

## 四、签名过程（对消息 $m$ 签名）

假设要对消息 $m$ 进行签名，步骤如下：

1. **计算消息摘要**  
   使用安全哈希函数（如 SHA-256）计算：
   $$
   e = H(m)
   $$
   （注意：实际参与运算的是 $e \bmod q$，记作 $z$。若哈希输出长度大于 $q$ 的位数，则截断或取模）

2. **生成临时随机数**

   随机选择一个保密的临时密钥 $k$，满足 $1 < k < q$

3. **计算** $r$
   
   $r = (g^k \bmod p) \bmod q$
   
   若 $r = 0$，则重新选择 $k$

4. **计算** $s$  
   
   $s = k^{-1} (z + x r) \bmod q$
   
   其中 $k^{-1}$ 是 $k$ 在模 $q$ 下的乘法逆元  
   若 $s = 0$，则重新选择 $k$

5. **签名结果**
   签名为二元组 $(r, s)$

⚠️ 注意：$k$ 必须每次不同且保密。如果重复使用 $k$，会导致私钥泄露（如索尼 PlayStation 3 事件）。


## 五、验证过程（验证签名 $(r, s)$ 是否有效）

验证者拥有公钥 $(p, q, g, y)$ 和消息 $m$，执行以下步骤：

1. **检查范围**  
   若 $r \notin [1, q-1]$ 或 $s \notin [1, q-1]$，则拒绝签名

2. **计算消息摘要**  
   $z = H(m) \bmod q$

3. **计算** $w$
   $$
   w = s^{-1} \bmod q
   $$

4. **计算** $u_1, u_2$
   $$
   u_1 = z \cdot w \bmod q \\
   u_2 = r \cdot w \bmod q
   $$

5. **计算** $v$
   $$
   v = \left( g^{u_1} \cdot y^{u_2} \bmod p \right) \bmod q
   $$

6. **验证**  
   若 $v = r$，则签名有效；否则无效。

### 六、[计算示例](./doc/dsa_example.md)

### 七、安全性与注意事项

- 安全性依赖于：
    - 离散对数问题的困难性。
    - 哈希函数的抗碰撞性。
    - 临时密钥 k 的随机性和唯一性。
- 不推荐使用 SHA-1（已被认为不安全），应使用 SHA-256 或 SHA-3。
- FIPS 186 已更新至 FIPS 186-5（2023 年），支持更长的密钥和更强的哈希算法。
- DSA 正逐渐被 ECDSA（椭圆曲线 DSA）取代，后者在相同安全强度下密钥更短、效率更高。


### 八、总结

| 特性 | 说明 |
|------|------|
| 类型 | 数字签名算法 |
| 安全基础 | 离散对数问题 |
| 支持操作 | 签名、验证（**不支持加密**） |
| 推荐哈希 | SHA-256、SHA-3 |
| 替代方案 | ECDSA（更高效） |
| 标准 | FIPS 186（最新为 FIPS 186-5） |

