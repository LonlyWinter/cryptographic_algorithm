# DSA计算示例

下面是一个**完整的、可验证的 DSA 签名与验证计算示例**，使用**较小但合法的参数**（仅用于教学，实际应用需使用大素数）。

## 一、系统参数（公共参数）

选择满足 DSA 要求的小素数：

- $ p = 7879 $：一个大素数  
- $ q = 101 $：$ q $ 是素数，且 $ q \mid (p - 1) $，因为 $ p - 1 = 7878 = 101 \times 78 $
- 选择 $ h = 3 $（任意满足 $1 < h < p-1$，使得$g > 1$）
- 计算 $ g = h^{(p-1)/q} \bmod p = 3^{78} \bmod 7879 = 170 $

✅ 所以系统参数为：
- $ p = 7879 $
- $ q = 101 $
- $ g = 170 $


## 二、密钥生成

- 私钥 $ x $：随机选 $ 1 < x < q $，比如 $ x = 75 $
- 公钥 $ y = g^x \bmod p = 170^{75} \bmod 7879 = 4567 $

✅ 密钥对：
- 私钥：$ x = 75 $
- 公钥：$ y = 4567 $

公钥完整形式：$ (p, q, g, y) = (7879, 101, 1704, 4567) $


## 三、签名消息

假设我们要签名的消息为字符串 `"Hello"`。

### 步骤 1：计算哈希值（简化处理）

为简化，我们**不使用 SHA-256**，而是直接定义消息摘要的整数值（教学目的）：

- 设 $ H(\text{"Hello"}) = 42 $
- 取 $ z = H(m) \bmod q = 42 \bmod 101 = 42 $

> 实际中应使用标准哈希函数（如 SHA-256），然后取前 $ \log_2 q $ 位或模 $ q $。

### 步骤 2：选择临时密钥 $ k $

选 $ k = 50 $（必须满足 $ 1 < k < q = 101 $）

### 步骤 3：计算 $ r $

$$
r = (g^k \bmod p) \bmod q = (170^{50} \bmod 7879) \bmod 101 = 2518 \bmod 101 = 94
$$

> 若 $ r = 0 $，需重选 $ k $，这里没问题。

### 步骤 4：计算 $ s $

计算：$ k^{-1} \bmod q = 50^{-1} \bmod 101 = 99 $

现在计算：
$$
s = k^{-1} (z + x r) \bmod q
= 99 \cdot (42 + 75 \cdot 94) \bmod 101
= 57
$$

> 若 $ s = 0 $，需重选 $ k $，这里没问题。

### ✅ 签名结果：$ (r, s) = (94, 57) $


## 四、验证签名

验证者拥有：
- 公钥 $ (p=7879, q=101, g=1704, y=4567) $
- 消息 $ m = \text{"Hello"} \Rightarrow z = 42 $
- 签名 $ (r=94, s=57) $

### 步骤 1：检查范围

- $ 0 < r = 94 < q = 101 $
- $ 0 < s = 57 < q = 101 $

### 步骤 2：计算 $ w = s^{-1} \bmod q $

$$
w = s^{-1} \bmod q = 57^{-1} \bmod 101 = 39
$$

### 步骤 3：计算 $ u_1, u_2 $

$$
u_1 = z \cdot w \bmod q = 42 \cdot 39 \bmod 101 = 22
$$

$$
u_2 = r \cdot w \bmod q = 94 \cdot 39 \bmod 101 = 30
$$

### 步骤 4：计算 $ v $

$$
v = \left((g^{u_1} \cdot y^{u_2}) \bmod p \right) \bmod q
= \left((170^{22} \cdot 4567^{30}) \bmod 7879\right) \bmod 101
= 94
$$

### ✅ 签名有效：$ v = r = 94 $

## 五、最终总结

| 步骤 | 值 |
|------|-----|
| $ p $ | 7879 |
| $ q $ | 101 |
| $ g $ | 170 |
| 私钥 $ x $ | 75 |
| 公钥 $ y $ | 4567 |
| 消息摘要 $ z $ | 42 |
| 临时密钥 $ k $ | 50 |
| 签名 $ r $ | 94 |
| 签名 $ s $ | 57 |
| 验证 $ v $ | 94 |
| 结果 | ✅ 有效 |

