# 扩展函数 E

DES 中的 **扩展函数 E**（Expansion Function）是 Feistel 轮函数中的一个关键步骤，其作用是将 **32 位的右半数据块**（R）**扩展为 48 位**，以便与 **48 位的子密钥**（Kᵢ）进行异或（XOR）操作。

## 一、基本功能

- **输入**：32 位（来自上一轮的右半部分 R）
- **输出**：48 位
- **方式**：通过**固定的位置复制和重排**实现“扩展”
- **目的**：
  - 使输入位数匹配子密钥（48 位）
  - 引入**扩散**（Diffusion）：1 位输入可能影响多个 S 盒
  - 增强雪崩效应

> 注意：E 函数**不是数学计算**，而是一个**固定的位选择表**（类似 PC-1/PC-2）

## 二、E 扩展表（共 48 项）

E 表定义了从 **32 位输入**（记为 R₁ 到 R₃₂）中**按顺序选取 48 位**的方式。  
表中每个数字表示**从输入的哪一位复制**（1-based 索引）。

### 完整 E 表（标准 DES 定义）：

```text
32,  1,  2,  3,  4,  5,
 4,  5,  6,  7,  8,  9,
 8,  9, 10, 11, 12, 13,
12, 13, 14, 15, 16, 17,
16, 17, 18, 19, 20, 21,
20, 21, 22, 23, 24, 25,
24, 25, 26, 27, 28, 29,
28, 29, 30, 31, 32,  1
```

> 共 8 行 × 6 列 = 48 个位置

## 三、操作原理详解

### 输入：32 位 R = [R₁, R₂, ..., R₃₂]

### 输出：48 位 E(R) = [E₁, E₂, ..., E₄₈]，其中：

- E₁ = R₃₂（最后一个位）
- E₂ = R₁
- E₃ = R₂  
- ...
- E₆ = R₅  
- E₇ = R₄（注意：**R₄ 被重复使用**）
- ...

### 关键特点：

1. **边界重叠**：
   - 每个 4 位组的**首尾位被相邻组共享**
   - 例如：第 1 组用 R₃₂,R₁–R₅；第 2 组用 R₄–R₉ → R₄、R₅ 被重复

2. **首尾相连**：
   - 最后一项 E₄₈ = R₁，第一项 E₁ = R₃₂ → 形成“环形”结构

3. **重复位**：
   - 总共有 **16 位被重复使用**（每组头尾各1位 × 8组 = 16次重复）
   - 实际唯一输入位仍是 32 位，但输出为 48 位

## 四、示例

假设右半部分 R（32 位）为（为简化，用十六进制表示）：

```
R = 0x12345678
→ 二进制：0001 0010 0011 0100 0101 0110 0111 1000
→ 位编号（1-based，从左到右）：
R₁=0, R₂=0, R₃=0, R₄=1, R₅=0, ..., R₃₂=0
```

现在计算前 6 位 E 输出（对应第一个 S 盒输入）：

- E₁ = R₃₂ = 0（最后一位）
- E₂ = R₁ = 0
- E₃ = R₂ = 0
- E₄ = R₃ = 0
- E₅ = R₄ = 1
- E₆ = R₅ = 0  
→ 第一组 6 位：`0 0 0 0 1 0` = `000010₂`

这 6 位将送入 **S₁ 盒**。

## 五、设计目的与密码学意义

| 目的 | 说明 |
|------|------|
| **匹配密钥长度** | 使 32 位 R 能与 48 位子密钥 XOR |
| **增强扩散性** | 1 位 R 的变化会影响**两个相邻 S 盒**（因位被重复使用） |
| **提高雪崩效应** | 小输入变化 → 多个 S 盒输出变化 → 快速扩散到整个密文 |
| **抵抗分析攻击** | 与 S 盒配合，增加差分/线性路径复杂度 |

> 例如：R 的第 5 位（R₅）出现在 E 的第 6 位（S₁ 输入）和第 7 位（S₂ 输入），因此会影响 **两个 S 盒**。

## 六、总结

- **E 函数 = 固定位扩展表**
- **输入 32 位 → 输出 48 位**
- **通过重复边界位实现重叠分组**
- **是 DES 扩散机制的重要组成部分**
