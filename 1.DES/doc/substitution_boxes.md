# S盒

DES 中的 **S盒**（Substitution Box，替换盒）是整个算法中**唯一的非线性组件**，也是 DES 抵抗密码分析（如差分分析、线性分析）的核心。它负责将 **48 位输入压缩并非线性地映射为 32 位输出**，通过 8 个独立的 **6→4 位 S 盒**（S₁ 到 S₈）并行完成。

## 一、S盒整体结构

- 共 **8 个 S 盒**：S₁, S₂, ..., S₈
- 每个 S 盒：
  - **输入**：6 位
  - **输出**：4 位
- 总体：48 位 →（拆成 8×6 位）→（8 个 S 盒并行）→ 8×4 = **32 位输出**

## 二、单个 S 盒的操作步骤（以任意 Sᵢ 为例）

给定一个 6 位输入：`b₁ b₂ b₃ b₄ b₅ b₆`

### 步骤 1：确定行（Row）
- 用**首尾两位** `b₁ b₆`（即第 1 位和第 6 位）组成一个 **2 位二进制数**
- 转换为十进制 → 行号 **r ∈ {0, 1, 2, 3}**

> 例如：`b₁b₆ = 10₂ → r = 2`

### 步骤 2：确定列（Column）
- 用**中间四位** `b₂ b₃ b₄ b₅` 组成一个 **4 位二进制数**
- 转换为十进制 → 列号 **c ∈ {0, 1, ..., 15}**

> 例如：`b₂b₃b₄b₅ = 0110₂ → c = 6`

### 步骤 3：查表
- 在 Sᵢ 表的第 **r 行、第 c 列** 找到一个 **4 位十进制数**（范围 0~15）
- 将该数转为 **4 位二进制**，作为输出

> 例如：S₁[2][6] = 12 → 输出 `1100`

## 三、8 个 S 盒的完整表格（标准 DES 定义）

每个 S 盒是一个 **4 行 × 16 列** 的整数表（值为 0~15）。

### S₁
```
14  4 13  1  2 15 11  8  3 10  6 12  5  9  0  7
 0 15  7  4 14  2 13  1 10  6 12 11  9  5  3  8
 4  1 14  8 13  6  2 11 15 12  9  7  3 10  5  0
15 12  8  2  4  9  1  7  5 11  3 14 10  0  6 13
```

### S₂
```
15  1  8 14  6 11  3  4  9  7  2 13 12  0  5 10
 3 13  4  7 15  2  8 14 12  0  1 10  6  9 11  5
 0 14  7 11 10  4 13  1  5  8 12  6  9  3  2 15
13  8 10  1  3 15  4  2 11  6  7 12  0  5 14  9
```

### S₃
```
10  0  9 14  6  3 15  5  1 13 12  7 11  4  2  8
13  7  0  9  3  4  6 10  2  8  5 14 12 11 15  1
13  6  4  9  8 15  3  0 11  1  2 12  5 10 14  7
 1 10 13  0  6  9  8  7  4 15 14  3 11  5  2 12
```

### S₄
```
 7 13 14  3  0  6  9 10  1  2  8  5 11 12  4 15
13  8 11  5  6 15  0  3  4  7  2 12  1 10 14  9
10  6  9  0 12 11  7 13 15  1  3 14  5  2  8  4
 3 15  0  6 10  1 13  8  9  4  5 11 12  7  2 14
```

### S₅
```
 2 12  4  1  7 10 11  6  8  5  3 15 13  0 14  9
14 11  2 12  4  7 13  1  5  0 15 10  3  9  8  6
 4  2  1 11 10 13  7  8 15  9 12  5  6  3  0 14
11  8 12  7  1 14  2 13  6 15  0  9 10  4  5  3
```

### S₆
```
12  1 10 15  9  2  6  8  0 13  3  4 14  7  5 11
10 15  4  2  7 12  9  5  6  1 13 14  0 11  3  8
 9 14 15  5  2  8 12  3  7  0  4 10  1 13 11  6
 4  3  2 12  9  5 15 10 11 14  1  7  6  0  8 13
```

### S₇
```
 4 11  2 14 15  0  8 13  3 12  9  7  5 10  6  1
13  0 11  7  4  9  1 10 14  3  5 12  2 15  8  6
 1  4 11 13 12  3  7 14 10 15  6  8  0  5  9  2
 6 11 13  8  1  4 10  7  9  5  0 15 14  2  3 12
```

### S₈
```
13  2  8  4  6 15 11  1 10  9  3 14  5  0 12  7
 1 15 13  8 10  3  7  4 12  5  6 11  0 14  9  2
 7 11  4  1  9 12 14  2  0  6 10 13 15  3  5  8
 2  1 14  7  4 10  8 13 15 12  9  0  3  5  6 11
```

> 注意：这些表格是 **DES 标准（FIPS PUB 46）** 固定定义的，不可更改。

## 四、操作示例

假设 S₁ 的输入为 `110101`（6 位）

1. 行：`b₁b₆ = 1` 和 `1` → `11₂ = 3` → 第 **3 行**（从 0 开始计数）
2. 列：`b₂b₃b₄b₅ = 1010₂ = 10` → 第 **10 列**
3. 查 S₁ 表第 3 行、第 10 列 → 值为 **14**
4. 14 的 4 位二进制 = `1110`
5. 输出：`1110`

## 五、S盒的设计原则（由 NSA 参与制定）

虽然最初被质疑有“后门”，但后来研究证明 S 盒具有以下优良性质：

| 性质 | 说明 |
|------|------|
| **非线性** | 无法用线性方程近似，抵抗线性密码分析 |
| **严格雪崩准则**（SAC） | 输入 1 位变化 → 输出约半数位翻转 |
| **无固定点/反固定点** | 避免 S(x) = x 或 S(x) = ¬x |
| **差分均匀性低** | 抵抗差分密码分析（最大差分概率 ≤ 1/4） |



