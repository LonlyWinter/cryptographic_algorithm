
# 密钥调度

DES 的**密钥调度**（Key Schedule）是将原始的 64 位输入密钥（含 8 个奇偶校验位）转换为 **16 个 48 位子密钥**（每轮 Feistel 迭代使用一个）的过程。以下是其**具体操作步骤**，按顺序详解：

## 一、输入：64 位原始密钥

- 用户提供 64 位密钥（通常以 8 字节表示）。
- 实际有效密钥长度为 **56 位**，因为每字节的第 8 位（最低位）用作奇偶校验位（在 DES 标准中被忽略）。

> 示例：密钥 `K = k₁k₂...k₆₄`，其中 `k₈, k₁₆, ..., k₆₄` 是奇偶位，不参与计算。

## 二、步骤 1：PC-1 置换（Permuted Choice 1）

- 使用 **PC-1 表**（56 项）从 64 位密钥中选择并打乱 56 位，丢弃 8 个奇偶位（第 8, 16, ..., 64 位）。
- 输出：56 位密钥 `K⁺`。
- 将 `K⁺` 分成左右两半：
  - **C₀** = 前 28 位
  - **D₀** = 后 28 位

> PC-1 完整置换表（共 56 项，1-based 索引）：
> ```
> 57, 49, 41, 33, 25, 17,  9,  1,
> 58, 50, 42, 34, 26, 18, 10,  2,
> 59, 51, 43, 35, 27, 19, 11,  3,
> 60, 52, 44, 36, 63, 55, 47, 39,
> 31, 23, 15,  7, 62, 54, 46, 38,
> 30, 22, 14,  6, 61, 53, 45, 37,
> 29, 21, 13,  5, 28, 20, 12,  4
> ```

## 三、步骤 2：16 轮循环左移（Left Circular Shift）

对每一轮 `i = 1 到 16`：

1. 对 `C_{i−1}` 和 `D_{i−1}` 分别进行**循环左移**（LS）：
   - 大多数轮次左移 **1 位**
   - 第 **1、2、9、16 轮**左移 **1 位**
   - 其余轮次（3–8, 10–15）左移 **2 位**

> 左移位数表：
> | 轮数 i | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |10|11|12|13|14|15|16 |
> |--------|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
> | 左移位数 | 1 | 1 | 2 | 2 | 2 | 2 | 2 | 2 | 1 | 2 | 2 | 2 | 2 | 2 | 2 | 1 |

2. 得到新的：
   - `C_i = LS(C_{i−1})`
   - `D_i = LS(D_{i−1})`

## 四、步骤 3：PC-2 压缩置换（Permuted Choice 2）

- 将 `C_i` 和 `D_i` 拼接成 56 位：`[C_i || D_i]`
- 使用 **PC-2 表**（48 项）从中选择 48 位，并重新排列，生成第 `i` 轮的子密钥 `K_i`

> PC-2 表（共 48 项，从 56 位中选 48 位）：
> ```
> 14, 17, 11, 24,  1,  5,
>  3, 28, 15,  6, 21, 10,
> 23, 19, 12,  4, 26,  8,
> 16,  7, 27, 20, 13,  2,
> 41, 52, 31, 37, 47, 55,
> 30, 40, 51, 45, 33, 48,
> 44, 49, 39, 56, 34, 53,
> 46, 42, 50, 36, 29, 32
> ```
> 注意：PC-2 中的数字是指 `[C_i || D_i]` 的**位位置**（1-based），不是原始密钥位置。

- 输出：**K₁, K₂, ..., K₁₆**，每个 48 位，用于加密的 16 轮 Feistel 函数。

## 五、解密时的密钥使用

- DES 解密过程与加密结构相同，**唯一区别是子密钥使用顺序反转**：
  - 加密用：K₁, K₂, ..., K₁₆
  - 解密用：K₁₆, K₁₅, ..., K₁

这是 Feistel 网络的天然特性，无需额外设计解密算法。

## 六、安全意义

- 密钥调度确保每轮使用**不同的子密钥**，增强混淆性。
- S 盒和密钥调度共同抵抗**差分/线性密码分析**。
- 但由于总密钥仅 56 位，**暴力破解可行**，故 DES 已不安全。

