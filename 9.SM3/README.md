# SM3算法

SM3 是中国国家密码管理局（OSCCA）于 2010 年发布的**商用密码杂凑算法标准**（标准号：`GM/T 0004-2012` / [`GB/T 32905-2016`](https://openstd.samr.gov.cn/bzgk/std/newGbInfo?hcno=45B1A67F20F3BF339211C391E9278F5E)），属于我国“国密”（GuoMi）密码体系的核心组成部分，主要用于生成数据的**摘要（哈希值）**，广泛应用于数字签名、消息认证、随机数生成等安全场景。

### 一、基本特性

| 项目 | 内容 |
|------|------|
| **算法类型** | 密码学哈希函数（Cryptographic Hash Function） |
| **输出长度** | **256 位（32 字节）** |
| **输入长度** | 任意长度（≤ $2^{64}-1$ 比特） |
| **安全性目标** | 抗碰撞（Collision Resistance）、抗原像（Preimage Resistance）、抗第二原像（Second Preimage Resistance） |
| **设计结构** | 基于 **Merkle-Damgård 构造**，采用 **Davies-Meyer 压缩函数** |
| **分组长度** | 512 比特（64 字节） |
| **迭代轮数** | **64 轮**非线性压缩操作 |

### 二、与国际主流哈希算法对比（如 SHA-256）

| 特性 | SM3 | SHA-256 |
|------|-----|--------|
| 输出长度 | 256 位 | 256 位 |
| 分组大小 | 512 位 | 512 位 |
| 压缩函数轮数 | 64 轮 | 64 轮 |
| 初始向量（IV） | 国家指定固定值（十六进制）：`7380166f 4914b2b9 172442d7 da8a0600 a96f30bc 163138aa e38dee4d b0fb0e4e` | 固定常数（基于 √2, √3 等无理数） |
| 非线性函数 | 使用 **布尔函数 FF 和 GG**（前 16 轮与后 48 轮不同） | 使用 Maj、Ch 等逻辑函数 |
| 安全强度 | 设计目标 ≈ SHA-256 | 广泛验证，NIST 标准 |
| 标准化 | 中国国密标准（GM/T 0004）ISO/IEC 10118-3:2018 国际标准 | FIPS 180-4（美国）全球通用 |

> ✅ **SM3 的安全强度与 SHA-256 相当**，但内部结构不同，是独立设计的国产算法。

### 三、SM3 的核心设计特点

1. **增强的混淆与扩散机制**：
   - 使用 **双非线性函数 FF 和 GG**，在不同轮次中切换；
   - 引入 **循环左移（ROL）和模加** 操作，提升雪崩效应。

2. **固定初始向量（IV）**：
   - IV 由国家密码管理局指定，不可更改，确保全国统一性和互操作性。

3. **填充规则**：
   - 与 SHA-2 类似：在消息末尾添加 `1`，然后填充 `0`，最后附加 64 位原始消息长度（单位：比特）。
   - 总长度必须是 512 位的整数倍。

4. **支持国密生态集成**：
   - 与 **SM2（签名/加密）**、**SM4（对称加密）**、**SM9（标识密码）** 协同使用；
   - 例如：SM2 签名时，需先用 SM3 计算带用户 ID 的 ZA 值，再对消息哈希。

### 四、典型应用场景

- **数字签名**：SM2 签名前必须使用 SM3 对消息（含用户身份信息）进行哈希；
- **SSL/TLS 国密协议**：如 GM/T 0024-2014 中的国密 TLS，使用 SM3 作为 PRF 和 MAC；
- **区块链与电子政务**：部分国产联盟链（如 FISCO BCOS）默认使用 SM3；
- **文件完整性校验**：替代 MD5/SHA1，用于高安全要求系统；
- **HMAC-SM3**：构造消息认证码（MAC），用于通信认证。

### 五、安全性现状

- 截至 2026 年，**SM3 尚未发现有效的实际碰撞或原像攻击**；
- 学术界对其进行了大量分析，认为其安全性**不低于 SHA-256**；
- 已通过 ISO/IEC 国际标准化，被多国研究机构认可。

### 总结

> **SM3 是中国自主设计的、安全高效的 256 位密码哈希算法，功能对标 SHA-256，但结构独立，专为满足国家密码合规与高安全需求而生。**  
> 在国产化替代、信创工程、金融安全等领域，SM3 已成为事实上的标准哈希算法。
